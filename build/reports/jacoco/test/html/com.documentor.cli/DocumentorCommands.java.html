<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DocumentorCommands.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">documentor</a> &gt; <a href="index.source.html" class="el_package">com.documentor.cli</a> &gt; <span class="el_source">DocumentorCommands.java</span></div><h1>DocumentorCommands.java</h1><pre class="source lang-java linenums">package com.documentor.cli;

import com.documentor.config.DocumentorConfig;
import com.documentor.model.ProjectAnalysis;
import com.documentor.service.CodeAnalysisService;
import com.documentor.service.DocumentationService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.shell.standard.ShellComponent;
import org.springframework.shell.standard.ShellMethod;
import org.springframework.shell.standard.ShellOption;

import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.util.concurrent.CompletableFuture;

/**
 * üñ•Ô∏è Command Line Interface for Documentor
 *
 * Provides interactive commands for analyzing projects and generating documentation.
 * Uses Spring Shell for a rich CLI experience.
 */
@ShellComponent
public class DocumentorCommands {

<span class="fc" id="L27">    private static final Logger LOGGER = LoggerFactory.getLogger(DocumentorCommands.class);</span>

    private final CodeAnalysisService codeAnalysisService;
    private final DocumentationService documentationService;
    private final DocumentorConfig documentorConfig;
    
    // Track current state
    private String currentProjectPath;
    private String currentConfigPath;

    public DocumentorCommands(
            final CodeAnalysisService codeAnalysisServiceParam,
            final DocumentationService documentationServiceParam,
<span class="fc" id="L40">            final DocumentorConfig documentorConfigParam) {</span>
<span class="fc" id="L41">        this.codeAnalysisService = codeAnalysisServiceParam;</span>
<span class="fc" id="L42">        this.documentationService = documentationServiceParam;</span>
<span class="fc" id="L43">        this.documentorConfig = documentorConfigParam;</span>
<span class="fc" id="L44">    }</span>

    /**
     * üöÄ Main command to analyze a project and generate documentation
     */
    @ShellMethod(value = &quot;Analyze a project and generate documentation&quot;,
            key = {&quot;analyze&quot;, &quot;generate&quot;})
    public String analyzeProject(
            @ShellOption(value = &quot;--project-path&quot;,
                    help = &quot;Path to the project directory to analyze&quot;)
            final String projectPath,
            @ShellOption(value = &quot;--config&quot;,
                    help = &quot;Path to configuration JSON file&quot;,
                    defaultValue = &quot;config.json&quot;)
            final String configPath) {

        try {
<span class="fc" id="L61">            LOGGER.info(&quot;üöÄ Starting analysis of project: {}&quot;, projectPath);</span>

            // Update current state
<span class="fc" id="L64">            this.currentProjectPath = projectPath;</span>
<span class="fc" id="L65">            this.currentConfigPath = configPath;</span>

            // Validate project path
<span class="fc" id="L68">            Path project = Paths.get(projectPath);</span>
<span class="pc bpc" id="L69" title="1 of 4 branches missed.">            if (!Files.exists(project) || !Files.isDirectory(project)) {</span>
<span class="fc" id="L70">                return &quot;‚ùå Error: Project path does not exist or is not a directory: &quot; + projectPath;</span>
            }

            // Analyze project
<span class="fc" id="L74">            CompletableFuture&lt;ProjectAnalysis&gt; analysisFuture = codeAnalysisService.analyzeProject(project);</span>
<span class="fc" id="L75">            ProjectAnalysis analysis = analysisFuture.join();</span>

            // Generate documentation
<span class="fc" id="L78">            CompletableFuture&lt;String&gt; docFuture = documentationService.generateDocumentation(analysis);</span>
<span class="fc" id="L79">            String outputPath = docFuture.join();</span>

<span class="fc" id="L81">            return String.format(&quot;‚úÖ Analysis complete! Documentation generated at: %s\n%s&quot;,</span>
<span class="fc" id="L82">                outputPath, analysis.getStats().getFormattedSummary());</span>

<span class="fc" id="L84">        } catch (Exception e) {</span>
<span class="fc" id="L85">            LOGGER.error(&quot;‚ùå Error during analysis: {}&quot;, e.getMessage(), e);</span>
<span class="fc" id="L86">            return &quot;‚ùå Error: &quot; + e.getMessage();</span>
        }
    }

    /**
     * üîç Command to only analyze a project without generating documentation
     */
    @ShellMethod(value = &quot;Analyze a project and show statistics&quot;,
            key = {&quot;scan&quot;, &quot;analyze-only&quot;})
    public String scanProject(
            @ShellOption(value = &quot;--project-path&quot;,
                    help = &quot;Path to the project directory to analyze&quot;)
            final String projectPath) {

        try {
<span class="fc" id="L101">            LOGGER.info(&quot;üîç Scanning project: {}&quot;, projectPath);</span>

            // Update current state
<span class="fc" id="L104">            this.currentProjectPath = projectPath;</span>

<span class="fc" id="L106">            Path project = Paths.get(projectPath);</span>
<span class="pc bpc" id="L107" title="1 of 4 branches missed.">            if (!Files.exists(project) || !Files.isDirectory(project)) {</span>
<span class="fc" id="L108">                return &quot;‚ùå Error: Project path does not exist or is not a directory: &quot; + projectPath;</span>
            }

<span class="fc" id="L111">            CompletableFuture&lt;ProjectAnalysis&gt; analysisFuture = codeAnalysisService.analyzeProject(project);</span>
<span class="fc" id="L112">            ProjectAnalysis analysis = analysisFuture.join();</span>

<span class="fc" id="L114">            StringBuilder result = new StringBuilder();</span>
<span class="fc" id="L115">            result.append(&quot;üìä Project Analysis Results\n&quot;);</span>
<span class="fc" id="L116">            result.append(&quot;‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n&quot;);</span>
<span class="fc" id="L117">            result.append(analysis.getStats().getFormattedSummary()).append(&quot;\n\n&quot;);</span>

<span class="fc" id="L119">            result.append(&quot;üìÅ Files analyzed:\n&quot;);</span>
<span class="fc" id="L120">            analysis.getElementsByFile().keySet().stream()</span>
<span class="fc" id="L121">                    .sorted()</span>
<span class="fc" id="L122">                    .forEach(file -&gt; result.append(&quot;  - &quot;).append(file).append(&quot;\n&quot;));</span>

<span class="fc" id="L124">            return result.toString();</span>

<span class="fc" id="L126">        } catch (Exception e) {</span>
<span class="fc" id="L127">            LOGGER.error(&quot;‚ùå Error during scan: {}&quot;, e.getMessage(), e);</span>
<span class="fc" id="L128">            return &quot;‚ùå Error: &quot; + e.getMessage();</span>
        }
    }

    /**
     * ‚öôÔ∏è Command to validate configuration
     */
    @ShellMethod(value = &quot;Validate configuration file&quot;,
            key = {&quot;validate-config&quot;, &quot;check-config&quot;})
    public String validateConfig(
            @ShellOption(value = &quot;--config&quot;,
                    help = &quot;Path to configuration JSON file&quot;,
                    defaultValue = &quot;config.json&quot;)
            final String configPath) {

        try {
<span class="fc" id="L144">            Path config = Paths.get(configPath);</span>
<span class="fc bfc" id="L145" title="All 2 branches covered.">            if (!Files.exists(config)) {</span>
<span class="fc" id="L146">                return &quot;‚ùå Configuration file not found: &quot; + configPath;</span>
            }

            // Basic validation - check if file is readable and has valid JSON structure
<span class="fc" id="L150">            String content = Files.readString(config);</span>
<span class="pc bpc" id="L151" title="1 of 2 branches missed.">            if (content.trim().isEmpty()) {</span>
<span class="nc" id="L152">                return &quot;‚ùå Configuration file is empty&quot;;</span>
            }

<span class="fc" id="L155">            return String.format(&quot;‚úÖ Configuration file is valid: %s\nSize: %d bytes&quot;,</span>
<span class="fc" id="L156">                configPath, Files.size(config));</span>

<span class="nc" id="L158">        } catch (Exception e) {</span>
<span class="nc" id="L159">            LOGGER.error(&quot;‚ùå Error validating config: {}&quot;, e.getMessage());</span>
<span class="nc" id="L160">            return &quot;‚ùå Error validating configuration: &quot; + e.getMessage();</span>
        }
    }

    /**
     * üìã Command to list supported file types
     */
    @ShellMethod(value = &quot;Show supported file types and features&quot;, key = {&quot;info&quot;, &quot;help-extended&quot;})
    public String showInfo() {
<span class="fc" id="L169">        return &quot;&quot;&quot;</span>
            üìö Documentor - AI-Powered Code Documentation Generator
            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

            üîç Supported Languages:
              ‚Ä¢ Java (.java) - Full AST parsing with JavaParser
              ‚Ä¢ Python (.py) - AST parsing with fallback to regex

            ü§ñ LLM Integration:
              ‚Ä¢ OpenAI GPT models (gpt-3.5-turbo, gpt-4, etc.)
              ‚Ä¢ Anthropic Claude models
              ‚Ä¢ Configurable endpoints and parameters
              ‚Ä¢ Multi-threaded processing for performance

            üìù Generated Documentation:
              ‚Ä¢ Comprehensive README.md
              ‚Ä¢ Individual element documentation
              ‚Ä¢ Usage examples with sample data
              ‚Ä¢ Unit test suggestions
              ‚Ä¢ API reference with signatures

            üõ†Ô∏è Features:
              ‚Ä¢ Markdown output with icons
              ‚Ä¢ Configurable coverage targets
              ‚Ä¢ Pre-commit hooks support
              ‚Ä¢ Gradle project structure
              ‚Ä¢ Multi-threaded LLM processing

            üìä Analysis Coverage:
              ‚Ä¢ Public classes, interfaces, and enums
              ‚Ä¢ Public methods and functions
              ‚Ä¢ Public fields and variables
              ‚Ä¢ Documentation extraction
              ‚Ä¢ Parameter and return type analysis

            Use 'analyze --project-path &lt;path&gt;' to get started!
            &quot;&quot;&quot;;
    }

    /**
     * üéØ Command to show quick start guide
     */
    @ShellMethod(value = &quot;Show quick start guide&quot;, key = {&quot;quick-start&quot;, &quot;getting-started&quot;})
    public String quickStart() {
<span class="fc" id="L213">        return &quot;&quot;&quot;</span>
            üöÄ Quick Start Guide
            ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

            1Ô∏è‚É£ Create a configuration file (config.json):
               {
                 &quot;llm_models&quot;: [{
                   &quot;name&quot;: &quot;gpt-3.5-turbo&quot;,
                   &quot;api_key&quot;: &quot;your-api-key-here&quot;
                 }],
                 &quot;output_settings&quot;: {
                   &quot;output_path&quot;: &quot;./docs&quot;
                 }
               }

            2Ô∏è‚É£ Analyze your project:
               analyze --project-path /path/to/your/project

            3Ô∏è‚É£ View generated documentation:
               Check the ./docs directory for generated files

            üí° Pro Tips:
               ‚Ä¢ Use 'scan' command to preview analysis results
               ‚Ä¢ Configure multiple LLM models for better results
               ‚Ä¢ Set include_icons: false for plain text output
               ‚Ä¢ Adjust max_threads for better performance

            For detailed configuration options, see the README.md file.
            &quot;&quot;&quot;;
    }

    /**
     * üìã Shows the current status of the application
     */
    @ShellMethod(value = &quot;Show current application status&quot;, key = {&quot;status&quot;, &quot;current&quot;})
    public String showStatus() {
<span class="fc" id="L249">        StringBuilder status = new StringBuilder();</span>
<span class="fc" id="L250">        status.append(&quot;üìã Documentor Status\n&quot;);</span>
<span class="fc" id="L251">        status.append(&quot;‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n&quot;);</span>

        // Current Project Information
<span class="fc" id="L254">        status.append(&quot;üìÅ Current Project:\n&quot;);</span>
<span class="pc bpc" id="L255" title="1 of 2 branches missed.">        if (currentProjectPath != null) {</span>
<span class="nc" id="L256">            Path projectPath = Paths.get(currentProjectPath);</span>
<span class="nc" id="L257">            status.append(&quot;   Path: &quot;).append(currentProjectPath).append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L258" title="All 2 branches missed.">            status.append(&quot;   Exists: &quot;).append(Files.exists(projectPath) ? &quot;‚úÖ Yes&quot; : &quot;‚ùå No&quot;).append(&quot;\n&quot;);</span>
<span class="nc bnc" id="L259" title="All 2 branches missed.">            if (Files.exists(projectPath)) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">                status.append(&quot;   Type: &quot;).append(Files.isDirectory(projectPath) ? &quot;Directory&quot; : &quot;File&quot;).append(&quot;\n&quot;);</span>
            }
<span class="nc" id="L262">        } else {</span>
<span class="fc" id="L263">            status.append(&quot;   No project currently selected\n&quot;);</span>
        }
<span class="fc" id="L265">        status.append(&quot;\n&quot;);</span>

        // Configuration Information
<span class="fc" id="L268">        status.append(&quot;‚öôÔ∏è Configuration:\n&quot;);</span>
<span class="pc bpc" id="L269" title="1 of 2 branches missed.">        if (currentConfigPath != null) {</span>
<span class="nc" id="L270">            status.append(&quot;   Config File: &quot;).append(currentConfigPath).append(&quot;\n&quot;);</span>
<span class="nc" id="L271">            Path configPath = Paths.get(currentConfigPath);</span>
<span class="nc bnc" id="L272" title="All 2 branches missed.">            status.append(&quot;   Config Exists: &quot;).append(Files.exists(configPath) ? &quot;‚úÖ Yes&quot; : &quot;‚ùå No&quot;).append(&quot;\n&quot;);</span>
<span class="nc" id="L273">        } else {</span>
<span class="fc" id="L274">            status.append(&quot;   Using default configuration\n&quot;);</span>
        }
<span class="fc" id="L276">        status.append(&quot;\n&quot;);</span>

        // LLM Models Information
<span class="fc" id="L279">        status.append(&quot;ü§ñ LLM Models:\n&quot;);</span>
<span class="pc bpc" id="L280" title="1 of 4 branches missed.">        if (documentorConfig != null &amp;&amp; documentorConfig.llmModels() != null) {</span>
<span class="fc" id="L281">            status.append(&quot;   Total Models: &quot;).append(documentorConfig.llmModels().size()).append(&quot;\n&quot;);</span>
<span class="fc bfc" id="L282" title="All 2 branches covered.">            for (int i = 0; i &lt; documentorConfig.llmModels().size(); i++) {</span>
<span class="fc" id="L283">                var model = documentorConfig.llmModels().get(i);</span>
<span class="fc" id="L284">                status.append(&quot;   &quot;).append(i + 1).append(&quot;. &quot;).append(model.name()).append(&quot;\n&quot;);</span>
<span class="pc bpc" id="L285" title="2 of 4 branches missed.">                status.append(&quot;      API Key: &quot;).append(model.apiKey() != null &amp;&amp; !model.apiKey().isEmpty() ? </span>
<span class="pc bpc" id="L286" title="1 of 2 branches missed.">                    (model.apiKey().length() &gt; 10 ? model.apiKey().substring(0, 10) + &quot;...&quot; : &quot;***&quot;) : &quot;Not set&quot;).append(&quot;\n&quot;);</span>
<span class="pc bpc" id="L287" title="2 of 4 branches missed.">                if (model.endpoint() != null &amp;&amp; !model.endpoint().isEmpty()) {</span>
<span class="fc" id="L288">                    status.append(&quot;      Endpoint: &quot;).append(model.endpoint()).append(&quot;\n&quot;);</span>
                }
<span class="fc" id="L290">                status.append(&quot;      Max Tokens: &quot;).append(model.maxTokens()).append(&quot;\n&quot;);</span>
<span class="fc" id="L291">                status.append(&quot;      Temperature: &quot;).append(model.temperature()).append(&quot;\n&quot;);</span>
<span class="fc bfc" id="L292" title="All 2 branches covered.">                if (i &lt; documentorConfig.llmModels().size() - 1) {</span>
<span class="fc" id="L293">                    status.append(&quot;\n&quot;);</span>
                }
            }
        } else {
<span class="fc" id="L297">            status.append(&quot;   No LLM models configured\n&quot;);</span>
        }
<span class="fc" id="L299">        status.append(&quot;\n&quot;);</span>

        // Output Settings
<span class="fc" id="L302">        status.append(&quot;üì§ Output Settings:\n&quot;);</span>
<span class="fc bfc" id="L303" title="All 4 branches covered.">        if (documentorConfig != null &amp;&amp; documentorConfig.outputSettings() != null) {</span>
<span class="fc" id="L304">            var outputSettings = documentorConfig.outputSettings();</span>
<span class="fc" id="L305">            status.append(&quot;   Output Path: &quot;).append(outputSettings.outputPath()).append(&quot;\n&quot;);</span>
<span class="fc" id="L306">            status.append(&quot;   Format: &quot;).append(outputSettings.format()).append(&quot;\n&quot;);</span>
<span class="pc bpc" id="L307" title="1 of 2 branches missed.">            status.append(&quot;   Include Icons: &quot;).append(outputSettings.includeIcons() ? &quot;‚úÖ Yes&quot; : &quot;‚ùå No&quot;).append(&quot;\n&quot;);</span>
<span class="pc bpc" id="L308" title="1 of 2 branches missed.">            status.append(&quot;   Generate Unit Tests: &quot;).append(outputSettings.generateUnitTests() ? &quot;‚úÖ Yes&quot; : &quot;‚ùå No&quot;).append(&quot;\n&quot;);</span>
<span class="fc" id="L309">            status.append(&quot;   Target Coverage: &quot;).append(String.format(&quot;%.1f%%&quot;, outputSettings.targetCoverage() * 100)).append(&quot;\n&quot;);</span>
<span class="fc" id="L310">        } else {</span>
<span class="fc" id="L311">            status.append(&quot;   Using default output settings\n&quot;);</span>
        }
<span class="fc" id="L313">        status.append(&quot;\n&quot;);</span>

        // Analysis Settings
<span class="fc" id="L316">        status.append(&quot;üîç Analysis Settings:\n&quot;);</span>
<span class="fc bfc" id="L317" title="All 4 branches covered.">        if (documentorConfig != null &amp;&amp; documentorConfig.analysisSettings() != null) {</span>
<span class="fc" id="L318">            var analysisSettings = documentorConfig.analysisSettings();</span>
<span class="pc bpc" id="L319" title="1 of 2 branches missed.">            status.append(&quot;   Include Private Members: &quot;).append(analysisSettings.includePrivateMembers() ? &quot;‚úÖ Yes&quot; : &quot;‚ùå No&quot;).append(&quot;\n&quot;);</span>
<span class="fc" id="L320">            status.append(&quot;   Max Threads: &quot;).append(analysisSettings.maxThreads()).append(&quot;\n&quot;);</span>
<span class="fc" id="L321">            status.append(&quot;   Supported Languages: &quot;).append(String.join(&quot;, &quot;, analysisSettings.supportedLanguages())).append(&quot;\n&quot;);</span>
<span class="fc" id="L322">            status.append(&quot;   Exclude Patterns: &quot;).append(String.join(&quot;, &quot;, analysisSettings.excludePatterns())).append(&quot;\n&quot;);</span>
<span class="fc" id="L323">        } else {</span>
<span class="fc" id="L324">            status.append(&quot;   Using default analysis settings\n&quot;);</span>
        }

<span class="fc" id="L327">        status.append(&quot;\nüí° Tip: Use 'analyze --project-path &lt;path&gt;' to set a new current project&quot;);</span>

<span class="fc" id="L329">        return status.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>